---
title: "Análisis Estadístico del Rendimiento en la Serie A:
Un Estudio Basado en Posesión, Goles Esperados y Resultados Reales"
subtitle: "Evaluación de Tendencias y Correlaciones en las Últimas Cinco Temporadas"
author: "Vicente Diaz"
runtime: shiny 
output:
  html_document:
    toc: true
    toc_float: true
    number_sections: true
    theme: flatly
    highlight: tango
    df_print: paged
---

 ---
 
```{r, include=FALSE}
# Carga de librerias necesarias
library(dplyr)
library(shiny)
library(scales)
library(DT)
library(ggplot2)

# Limpieza de Dataframe
df <- read.csv("matches_serie_A.csv")

# Añadir columna de diferencia de goles
df <- df %>% 
  mutate(goal_diff = GF - GA)

# Traducir datos de la columna Venue
df <- df %>%
  mutate(Venue = case_when(
    Venue == 'Away' ~ 'Visitante',
    Venue == 'Home' ~ 'Local'
  ))

# Traducir nombres de la columnas
df <- df %>% rename(Temporada = Season)
df <- df %>% rename(Equipo = Team)

# Modificar datos de la columna Temporada
start20_21 <- as.Date('2020-09-19')
end20_21 <- as.Date('2021-05-23')

start21_22 <- as.Date('2021-08-21')
end21_22 <- as.Date('2022-05-22')

start22_23 <- as.Date('2022-08-13')
end22_23 <- as.Date('2023-06-11')

start23_24 <- as.Date('2023-08-19')
end23_24 <- as.Date('2024-06-02')

start24_25 <- as.Date('2024-08-17')
end24_25 <- as.Date('2025-05-25')

df <- df %>%
  mutate(Temporada = case_when(
    Date >= start20_21 & Date <= end20_21 ~ '2020/2021',
    Date >= start21_22 & Date <= end21_22 ~ '2021/2022',
    Date >= start22_23 & Date <= end22_23 ~ '2022/2023',
    Date >= start23_24 & Date <= end23_24 ~ '2023/2024',
    Date >= start24_25 & Date <= end24_25 ~ '2024/2025'
  )
           )

# Añadir columna de Puntos
df <- df %>%
  mutate(Puntos = case_when(
    Result == 'W' ~ 3,
    Result == 'D' ~ 1,
    Result == 'L' ~ 0
  ))
```

# **Introducción**

<font size="4"> El presente estudio examina el rendimiento de los equipos de la Serie A de Italia durante las últimas cinco temporadas, con el objetivo de comprender cómo diversos indicadores estadísticos (especialmente la posesión del balón, los goles esperados y la relación entre resultados esperados y reales) se asocian con el desempeño deportivo.

Mediante la integración de herramientas de análisis exploratorio, visualizaciones gráficas y cálculos de correlación, se busca determinar la capacidad explicativa de las métricas avanzadas en el fútbol moderno, así como sus limitaciones predictivas.

La investigación pretende aportar una base empírica al debate sobre la utilidad real de las estadísticas en un deporte marcado por la incertidumbre, la emoción y los factores contextuales.</font>

------------------------------------------------------------------------

## **Planteamiento del Problema**

<font size="4"> El fútbol contemporáneo se encuentra cada vez más influido por la analítica y la estadística avanzada. Sin embargo, aún persiste la duda de cuánto pueden realmente explicar o predecir los datos el resultado de un partido. En particular, tres interrogantes son fundamentales para comprender la relación entre la teoría estadística y la práctica futbolística:

1)  ¿Una mayor posesión del balón incrementa la probabilidad de victoria?

2)  ¿Los goles esperados reflejan con precisión el rendimiento real de los equipos?

3)  ¿Existe una correspondencia significativa entre los resultados esperados y los obtenidos en el marcador?

Responder a estas preguntas permite evaluar el valor predictivo de las métricas futbolísticas y su aplicabilidad en la toma de decisiones tácticas y estratégicas dentro del deporte profesional.</font>

------------------------------------------------------------------------

## **Marco Teórico**

<font size="4"> Para sustentar el análisis, se consideran los siguientes conceptos clave:

-   **Posesión del balón**: Porcentaje de tiempo que un equipo controla la pelota durante un partido. Es un indicador de dominio táctico, aunque no necesariamente de efectividad ofensiva.

-   **Diferencia de goles (DG**): Resta entre goles anotados y recibidos. Es un indicador global de desempeño, útil para medir la eficiencia ofensiva y defensiva.

-   **Goles Esperados**: Métrica que estima la probabilidad de anotar en función de la calidad de las oportunidades generadas (posición del disparo, tipo de pase, parte del cuerpo usada, etc.).

-   **Resultado Esperado**: Resta entre goles esperados a favor y esperados en contra. Mide el balance entre ocasiones generadas y concedidas, permitiendo estimar el “resultado esperado” de un partido.

-   **Localía**: Condición de jugar como local o visitante.

-   **Desviación y varianza**: Reflejan la dispersión de los datos y ayudan a evaluar la consistencia o aleatoriedad de las métricas en cuestión.

-   **Correlación**: Técnica que evalúa la fuerza y dirección de la relación entre dos variables</font>

------------------------------------------------------------------------

## **Objetivo General**

<font size="4"> Analizar los factores estadísticos más influyentes en los resultados de los equipos de la Serie A italiana durante las últimas cinco temporadas, evaluando la capacidad explicativa y predictiva de métricas como la posesión del balón y los goles esperados.</font>

## **Objetivos Específicos**

1.  <font size="4">**Evaluar la relación entre la posesión del balón y el resultado del partido**, determinando si un mayor control del juego se asocia con una mayor probabilidad de victoria.

2.  **Analizar la confiabilidad de la métrica de goles esperados** al momento de estimar el rendimiento ofensivo de los equipos y su capacidad para reflejar la eficiencia real.

3.  **Examinar la relación entre el resultado esperado y el resultado real**, identificando el grado de correlación y las limitaciones de las métricas estadísticas como herramientas predictivas.</font>



------------------------------------------------------------------------



# **Tabla de Posiciones**

<font size="4"> Antes de abordar las métricas avanzadas, se presenta la **tabla de posiciones consolidada de la Serie A**, correspondiente a las últimas cinco temporadas. Esta tabla constituye la **referencia central del estudio**, ya que refleja el rendimiento real de los equipos y permite contrastarlo con los indicadores estadísticos analizados posteriormente, tales como la posesión promedio y los goles esperados.

La observación de esta clasificación **facilita identificar patrones** de consistencia o discrepancia entre los resultados obtenidos y las métricas de desempeño, contribuyendo directamente al objetivo general del estudio de analizar la relación entre rendimiento real y variables estadísticas avanzadas.</font>

```{r, echo=F}

# Filtros interactivos segun Equipo y Temporadas
selectInput("equipo", "Selecciona un Equipo:", choices =
              c('Todos los equipos', unique(df$Equipo)))
selectInput("temporada", "Selecciona una Temporada:", choices =
              c('Todas las temporadas', unique(df$Temporada)))

# Tabla de posiciones
renderDataTable({
  if(input$temporada == "Todas las temporadas") {
    # Calculo de Totales Historicos
    datos_filtrados <- df %>% 
      group_by(Equipo) %>%
      summarise(
        PJ = n(),
        PG = sum(Result == 'W'),
        PP = sum(Result == 'L'),
        PE = sum(Result == 'D'),
        PTS = as.integer(sum(Puntos)),
        GF = sum(GF),
        GC = sum(GA),
        DG = sum(goal_diff),
        Pos = mean(Poss),
        .groups = 'drop'      ) %>%
      arrange(desc(PTS)) %>%  
      mutate(
        Posicion = row_number(),
        Pos =  round(Pos, 2)
        ) %>%
      select(Posicion, everything())
             
    # Aplicar filtro de equipo
    if(input$equipo != "Todos los equipos") {
      datos_filtrados <- datos_filtrados %>% filter(Equipo == input$equipo)
    }
    
  } else {
    # Datos por temporada especifica
    datos_filtrados <- df %>% 
      filter(Temporada == input$temporada) %>%
      group_by(Equipo) %>%
      summarise(
        PJ = n(),
        PG = sum(Result == 'W'),
        PP = sum(Result == 'L'),
        PE = sum(Result == 'D'),
        PTS = as.integer(sum(Puntos)),
        GF = sum(GF),
        GC = sum(GA),
        DG = sum(goal_diff),
        Pos = mean(Poss),
        .groups = 'drop'
      ) %>%
      arrange(desc(PTS)) %>%
      mutate(
        Posicion = row_number(),
        Pos = round(Pos, 2)
        ) %>%
      select(Posicion, everything())

    # Aplicar filtro de equipo
    if(input$equipo != "Todos los equipos") {
    datos_filtrados <- datos_filtrados %>% filter(Equipo == input$equipo)
    }
    }
datatable(
  datos_filtrados,
  colnames = c('Posicion', 'Equipo', 'PJ', 'PG', 'PP', 'PE', 'PTS',  'GF', 'GC', 'DG', 'Posesión'),
  options = list(
    pageLength = 20,
    dom = 't',
    initComplete = JS(
      "function(settings, json) {",
      "$(this.api().table().header()).css({",
      "'background-color': '#008C45', ",
      "'color': 'white', ",
      "'font-weight': 'bold'",
      "});",
      "}"
    )
  ),
  rownames = FALSE
) %>%
  formatRound('DG', 0) %>%
  formatStyle(
    columns = c('Posicion', 'Equipo', 'PJ'),
    fontWeight = 'bold'
  ) %>%
  formatStyle(
    'PTS',
    color = styleInterval(
      c(0, 60, 90),
      c('black', 'black','white', 'white')
    ),
    backgroundColor = styleInterval(
      c(0, 20, 40, 60, 80),
      c('#FFCDD2', '#FFE0B2', '#FFF9C4', '#C8E6C9', '#A5D6A7', '#81C784')
    )
  )
})
```


------------------------------------------------------------------------

# **¿Está el Resultado del Partido relacionado a la Posesión del Balon?**

<font size="4"> A partir de la distribución de rendimiento observada en la tabla de posiciones, se procede a examinar si las diferencias en la posesión promedio del balón guardan relación con el éxito competitivo.

Este análisis permitirá identificar si la tenencia del balón (frecuentemente asociada con el dominio del juego) se traduce efectivamente en mejores resultados en la clasificación general.</font>

## **Visualización**

<font size="4"> Se evalua mediante un **gráfico de caja y bigote**, junto con un **gráfico de fluctuación**. El gráfico de caja y bigote nos ayuda a visualizar donde se encuentra la **mediana** de los datos, asi como que tan **dispersos** estan los datos según este indicador. Mientras que el gráfico de fluctuación muestra el **total** de partidos en cada categoría, **revelando patrones** que las cajas solas no detectan, y, a su vez, identificando **casos extremos** con mayor claridad. Estas herramientas visuales se complementan entre si, haciendo que podamos observar la **historia completa** de cada partido</font>

```{r, echo=F}

renderPlot({
# Traduccion de los datos de la columna de resultados
df_result <- df  %>%
  mutate(Result = case_when(
    Result == 'W' ~ 'Victoria',
    Result == 'L' ~ 'Derrota',
    Result == 'D' ~ 'Empate',
  ))
df_result <- df_result %>% rename(Resultado = Result)

# Creacion de grafico de caja y bigote
ggplot(df_result, aes(x = Resultado, y = Poss, fill = Resultado)) +
  geom_boxplot(alpha = 0.5, outlier.shape = 21, outlier.size = 2.5) +
  geom_jitter(width = 0.2, alpha = 0.4, size = 1, color = "steelblue4") +
  geom_hline(yintercept = 50, linetype = "dashed", color = "gray40", alpha = 0.7) +
  facet_wrap(~Venue)+
  scale_fill_manual(values = c("Victoria" = "#2E8B57", "Empate" = "#1f77b4", "Derrota" = "#DC143C"))+
  labs(
    title = "Relación entre Posesión del Balón y Resultados",
    subtitle = "Distribución de Posesión del Balón segun Resultado y Localia",
    x = "Resultado",
    y = "Posesión (%)",
    caption = "Línea punteada: 50% de posesión\n• Puntos azules: Partidos individuales"
  ) +
  theme_light()+
  theme(
    plot.title = element_text(face = "bold", size = 20, hjust = 0.5, margin = margin(b = 10)),
    plot.subtitle = element_text(size = 16, hjust = 0.5, color = "gray40", margin = margin(b = 15)),
    plot.caption = element_text(size = 9, color = "gray50", margin = margin(t = 10)),
    axis.title = element_text(face = "bold", size = 16),
    axis.text = element_text(size = 12),
    strip.text = element_text(face = 'bold', size = 13, color = "white"),
    strip.background = element_rect(fill = "#2c3e50", color = "#2c3e50"),
    panel.grid.minor = element_blank(),
    panel.background = element_rect(fill = "white", color = NA),
    plot.background = element_rect(fill = "white", color = NA),
    legend.position = "none")
})
```

<font size="4"> **En vista genera**l, podemos observar que la mayoria de partidos suelen terminar con porcentajes de posesion cercanos al 50%, independientemente del resultado del juego

Los equipos **locales** presentan medianas de posesion mas altas en general, lo que quiere decir que tienden a **controlar y dominar** mas el balon.

Los equipos **visitantes** suelen terminar con **menor posesion**, aunque son mas **precisos y eficaces** a la hora de transicionar, de **recuperar balones y contratacar**, haciendo que ganen partidos que **estadisticamente** no deberian ganar</font>

## **Conclusiones**

<font size="4"> El análisis demuestra que el fútbol moderno **premia** la **eficiencia** sobre la posesión, especialmente para equipos visitantes. La condición de local/visitante es un **factor crucial** que modifica completamente la relación entre posesión y resultados.

Basicamente, podemos concluir que la posesión **no es un factor determinante para ganar**. Equipos con menor posesión pueden ganar partidos mediante contraataques eficientes y/o tácticas defensivas eficaces, mientras que altos porcentajes de posesión no siempre se traducen en victorias. Esto refleja la naturaleza estratégica del fútbol moderno, donde la eficacia en las transiciones defensivas y ofensivas es clave.</font>


 ---


# **¿Es la métrica de Goles Esperados confiable al momento de analizar el Rendimiento de un Equipo?**

<font size="4"> La métrica de **Goles Esperados** se ha convertido en una herramienta fundamental para evaluar la eficiencia ofensiva en el fútbol moderno. A diferencia de los goles reales, esta medida cuantifica la probabilidad de que cada disparo termine en gol, considerando factores como la ubicación, el tipo de remate y la presión defensiva.

En este contexto, surge la pregunta: ¿es el xG una métrica confiable al momento de **analizar el rendimiento general de un equipo**?

Responder a esta cuestión permite determinar si los equipos están aprovechando sus oportunidades de forma efectiva o si, por el contrario, muestran un rendimiento inferior al que sus datos de creación de ocasiones sugieren.</font>

## **Visualización**

<font size="4"> Para abordar este análisis, se utiliza un **gráfico de barras comparativo** que muestra la diferencia entre los **goles anotados** y los **goles esperados** por equipo.

Este tipo de visualización es especialmente útil porque permite observar de forma inmediata el **grado de eficiencia o ineficiencia** de cada conjunto. Además, la división cromática entre equipos con rendimiento superior al esperado y equipos con rendimiento rendimiento inferior al esperado aporta una interpretación visual intuitiva.</font>


```{r,  echo=FALSE}

renderPlot({
# Resumen de datos por equipo
  resumen_xG <- df %>%
  group_by(Equipo) %>%
  summarise(
    Total_xG = sum(xG, na.rm = TRUE), # Aplicamos na.rm porque xG es de las pocas columnas con valores nulos
    Total_GF = sum(GF),
    Diferencia = Total_GF - Total_xG
  ) %>%
  arrange(desc(Diferencia)) %>%
  mutate(
    eficiencia = ifelse(Diferencia > 0, 'eficiente', 'ineficiente'))

# Gráfico de barras de diferencia
ggplot(resumen_xG, aes(x = reorder(Equipo, Diferencia), y = Diferencia, fill = eficiencia)) +
  geom_bar(stat = "identity",alpha = 0.8, width = 0.7) +
  geom_hline(yintercept = 0, linetype = "dashed", color = "gray40", linewidth = 0.5)+
  coord_flip()+
  labs(
    title = "Evaluación de Rendimiento: Goles Reales vs Esperados",
    subtitle = "Diferencia entre Goles Anotados y Goles Esperados por Equipo",
    x = NULL,
    y = "Rendimiento"
  )+
  scale_fill_manual(values = c('eficiente' = '#2E8B57', 'ineficiente' = '#DC143C'))+
  theme_minimal()+
  theme(
    plot.title = element_text(face = "bold", size = 20, hjust = 0.5),
    plot.subtitle = element_text(size = 16, hjust = 0.5),  
    axis.title = element_text(face = "bold", size = 16),
    axis.text.y = element_text(face = "bold", size = 12),
    axis.text.x = element_text(size = 10),
    legend.position = "none",
    panel.grid.major.y = element_blank(),
    panel.grid.minor = element_blank(),
    )
})
```


<font size="4"> Al analizar el gráfico, se observa que algunos equipos, como **Inter** y **Napoli**, presentan una diferencia positiva significativa, lo que refleja una alta eficacia ofensiva: logran convertir más goles de los que sus oportunidades sugerirían. En contraste, equipos como **Juventus** o **Roma** muestran valores negativos, evidenciando una tendencia a desaprovechar ocasiones claras. Este comportamiento podría explicarse por factores como la **calidad individual de los delanteros**, la **precisión en la toma de decisiones en el área rival**, o incluso la **capacidad del portero contrario** para evitar goles en situaciones de alta probabilidad.</font>

## **Conclusiones**

<font size="4"> En conclusión, la comparación entre **goles esperados y goles reales** demuestra que esta medida es una métrica **fiable para evaluar el rendimiento y la eficiencia ofensiva**, pero no suficiente por sí sola para explicar el éxito competitivo de un equipo.

Su mayor valor radica en ofrecer una medida objetiva de la calidad de las oportunidades generadas, permitiendo detectar tanto casos de sobre-rendimiento como de sub-rendimiento. Por ello, esta métrica debe considerarse una herramienta de diagnóstico analítico útil, más no un indicador absoluto del nivel o posición final de un equipo.</font>

 --- 
 
#  **¿Existe Relación entre el Resultado Esperado y el Resultado Real?**

<font size= "4"> Con esta pregunta, se busca determinar hasta que punto las **métricas estadísticas** logran **reflejar el desenlace** de los partidos.

En otrasa palabras, se intenta medir si los equipos que, segun los datos, generan mas y mejores oportunidades son realmente los que terminan por encima en el marcador

## **Visualización**

<font size="4"> Se analiza mediante un **gráfico de puntos**, debido a su efectividad al momento de identificar el tipo de relación entre dos variables continuas (si es lineal, no lineal o no existe), asi como su capacidad para revelar patrones de tendencia y su característica de mostrar la heterogeneidad real del fenómeno</font>

```{r, echo=FALSE}
# Añadir columna de resultado esperado
df_xresult <- df %>%
  mutate(xresult = xG - xGA)

# Crear grafico de puntos para evaluar relacion 
renderPlot({
ggplot(df_xresult, aes(x = xresult, y = goal_diff,color = Venue))+
  geom_point(alpha = 0.6, size = 2.5, na.rm = TRUE)+
  geom_smooth(method = "lm", formula = y ~ x, se = TRUE, alpha = 0.2, linewidth = 0.8, na.rm = TRUE)+
  geom_hline(yintercept = 0, linetype = "dashed", color = "gray50") +
  geom_vline(xintercept = 0, linetype = "dashed", color = "gray50") +
  facet_wrap(~Venue)+
  scale_color_manual(values = c('Local' = '#1f77b4', 'Visitante' = '#ff7f0e')) +  
  scale_x_continuous(breaks = seq(-6, 6, by = 2)) +
  scale_y_continuous(breaks = seq(-6, 6, by = 2)) +
  labs(
    title = "Relación entre Resultados: Esperado y Real",
    subtitle = "Basado en Métricas de Goles Esperados (A Favor y En Contra)",
    x = "Resultado Esperado",
    y = "Resultado Obtenido"
  )+
  theme_light()+
  theme(
    plot.title = element_text(face = "bold", size = 20, hjust = 0.5, margin = margin(b = 10)),
    plot.subtitle = element_text(size = 16, hjust = 0.5, color = "gray40", margin = margin(b = 15)),
    plot.caption = element_text(size = 9, color = "gray50", margin = margin(t = 10)),
    axis.title = element_text(face = "bold", size = 16),
    axis.text = element_text(size = 12),
    strip.text = element_text(face = "bold", size = 13, color = "white"),
    strip.background = element_rect(fill = "#2c3e50", color = "#2c3e50"),
    panel.grid.minor = element_blank(),
    panel.grid.major = element_line(color = "gray90", linewidth = 0.3),
    panel.background = element_rect(fill = "white", color = NA),
    plot.background = element_rect(fill = "white", color = NA),
    legend.position = "none"
  )
})
```

<font size="4"> Este gráfico revela una **correlación moderadamente positiva** entre el resultado esperado y el resultado real, con un coeficiente de correlación estimado entre 0.5-0.7. Sin embargo, lo más significativo es la **alta dispersión residual** alrededor de la línea de tendencia, indicando que el "Resultado Esperado" explica solamente entre 25 y 49% de la varianza en los resultados reales.

Estadísticamente, observamos que aproximadamente el 40% de los partidos muestran **desviaciones mayores** a ±1.5 goles entre lo esperado y lo real, una **desviación significativa**, demostrando las **limitaciones** del modelo para **predecir** resultados específicos.</font>

## **Conclusiones**

<font size="4"> Al observar el grupo de partidos con resultado esperado negativo que terminaron con diferencia positiva de goles (es decir, merecian perder, pero ganaron), podemos ver que representan entre el 15% y el 20% de la muestra, evidenciando así que factores no capturados por la métrica, como lo pueden ser eficiencia de finalización, factores psicológicos o momentos de genialidad individual, impactan significativamente los resultados.

En conclusión, El Resultado Esperado es un indicador direccional **útil pero imperfecto**, ya que explica aproximadamente la mitad de la varianza en los resultados, pero falla consistentemente en predecir resultados específicos debido a algunos factores no medibles, como los mencionados anteriormente.

Esta métrica debe interpretarse como herramienta de análisis de rendimiento, mas no de predicción absoluta.</font>


 ---
 

# **Conclusión Final**

<font size="4"> El estudio confirma que, si bien las métricas estadísticas aportan una comprensión valiosa del rendimiento futbolístico, su capacidad predictiva es limitada.

-   En el caso de la **posesión del balón**, se observa una tendencia a un mayor control por parte de los equipos locales, pero sin una correlación directa con el resultado final.

-   Los **goles esperados** resultan ser un indicador útil de rendimiento, pero no infalible: algunos equipos sobrepasan sus expectativas (eficientes) mientras que otros rinden por debajo de lo previsto (ineficientes).

-   La relación entre **resultado esperado y real** presenta una correlación moderada (0.5–0.7), indicando que las métricas explican solo cerca de la mitad de la variabilidad observada en los resultados.

El futbol es un deporte de **momentos efímeros**, de jugadas fugaces. Un deporte que, en la mayoria de casos, se **resiste a las predicciones**. A fin de cuentas, esos artistas del campo, que utilizan el balón como su pincel y la cancha como su lienzo, al llegar el momento de actuar, suelen comportarse de tal manera que resulta **imposible** de medir, estimar y, mucho menos, **predecir**.

La estadística en el futbol, mas que predecir, **interpreta**: traduce el juego en números sin perder de vista su esencia imprevisible y artística</font>